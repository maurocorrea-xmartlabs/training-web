generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User{
  id Int @id @default(autoincrement())
  name String
  email String @unique
  password String

  // I comment this because subjects are global right now, so this relation is not needed
  //subjects Subject[]
  sessions Session[]

  passwordResetToken String?
  tokenExpirationDate DateTime?
}

model Session {
  id        String   @id
  userId    Int
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
}

model Subject {
  id          Int       @id @default(autoincrement())
  name        String
  monthlyCost Int

  // Commented for the same reason that above
  //userId Int
  //user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  projects    Project[]
  exams       Exam[]
  resources ResourceMetadata[]
}

model Project {
  id        Int     @id @default(autoincrement())
  name      String
  credits   Int

  subjectId Int
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  tasks     Task[]
}

model Task {
  id          Int     @id @default(autoincrement())
  name        String
  description String

  projectId  Int
  project    Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Exam {
  id        Int      @id @default(autoincrement())

  minScore  Int
  maxScore  Int
  date      DateTime

  subjectId Int
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)
}

model ResourceMetadata{
  id Int @id @default(autoincrement())
  key String @unique
  subjectId Int
  subject Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)
}

